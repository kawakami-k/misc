#include <stdio.h>
#include <stdlib.h>
#include <sys/auxv.h>

#ifndef HWCAP_FP
#include <asm/hwcap.h>
#endif

#define GETAUXVAL(a) printf(#a "=%016lx\n", getauxval(a))
#define GETFEATURE(a) if(hwcaps & a) \
    printf(#a ":true\n"); \
  else \
    printf(#a ":false\n");

void dump_id_aa64pfr0_el1() {
  unsigned long hwcaps = getauxval(AT_HWCAP);

  GETFEATURE(HWCAP_FP);

  GETFEATURE(HWCAP_ASIMD);
  GETFEATURE(HWCAP_EVTSTRM);
  GETFEATURE(HWCAP_AES);
  GETFEATURE(HWCAP_PMULL);
  GETFEATURE(HWCAP_SHA1);
  GETFEATURE(HWCAP_SHA2);
  GETFEATURE(HWCAP_CRC32);
  GETFEATURE(HWCAP_ATOMICS);
  GETFEATURE(HWCAP_FPHP);
  GETFEATURE(HWCAP_ASIMDHP);
  GETFEATURE(HWCAP_CPUID);
  GETFEATURE(HWCAP_ASIMDRDM);
  GETFEATURE(HWCAP_JSCVT);
  GETFEATURE(HWCAP_FCMA);
  GETFEATURE(HWCAP_LRCPC);
  GETFEATURE(HWCAP_DCPOP);
  GETFEATURE(HWCAP_SHA3);
  GETFEATURE(HWCAP_SM3);
  GETFEATURE(HWCAP_SM4);
  GETFEATURE(HWCAP_ASIMDDP);
  GETFEATURE(HWCAP_SHA512);
  GETFEATURE(HWCAP_SVE);
  GETFEATURE(HWCAP_ASIMDFHM);
  GETFEATURE(HWCAP_DIT);
  GETFEATURE(HWCAP_USCAT);
  GETFEATURE(HWCAP_ILRCPC);
  GETFEATURE(HWCAP_FLAGM);
  //  GETFEATURE(HWCAP_SSBS);
  //  GETFEATURE(HWCAP_SB);
  //  GETFEATURE(HWCAP_PACA);
  //  GETFEATURE(HWCAP_PACG);
}

int main() {

  GETAUXVAL(AT_HWCAP);
  GETAUXVAL(AT_HWCAP2);
  GETAUXVAL(AT_ICACHEBSIZE);
  GETAUXVAL(AT_L1D_CACHEGEOMETRY);
  GETAUXVAL(AT_L1D_CACHESIZE);
  GETAUXVAL(AT_L1I_CACHEGEOMETRY);
  GETAUXVAL(AT_L1I_CACHESIZE);
  GETAUXVAL(AT_L2_CACHEGEOMETRY);
  GETAUXVAL(AT_L2_CACHESIZE);
  GETAUXVAL(AT_L3_CACHEGEOMETRY);
  GETAUXVAL(AT_L3_CACHESIZE);
  GETAUXVAL(AT_PAGESZ);

  dump_id_aa64pfr0_el1();

  return 0;
}
